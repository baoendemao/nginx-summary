* nginx的upstream模块使用的是一致性哈希算法来分配节点的。nginx通过配置的分配变量来指定负载均衡策略, 常用的三种分配策略：
    * 根据客户端ip
    ```
        upstream somestream {
            consistent_hash $remote_addr;
            server 10.xx.xx.1:12800;
            server 10.xx.xx.2:12800;
            server 10.xx.xx.3:12800;
        }
    ```
    * 根据客户端请求的uri
    ```
        upstream somestream {
            consistent_hash $request_uri;
            server 10.xx.xx.1:12800;
            server 10.xx.xx.2:12800;
            server 10.xx.xx.3:12800;
        }
    ```
    * 根据客户端携带的请求参数
    ```
        upstream somestream {
            consistent_hash $args;
            server 10.xx.xx.1:12800;
            server 10.xx.xx.2:12800;
            server 10.xx.xx.3:12800;
        }
    ```
* 一致性哈希原理
    * 一致性哈希将整个哈希值空间组织成了一个虚拟的圆环，假设某哈希函数H的值空间是0到（2的32次方-1），即哈希值是一个32位无符号整数。其中哈希空间按顺时针方向组织，0和（2的32次方-1）会在12点钟方向重合。
    * 如果选择ip作为哈希函数的入参，通过哈希函数，得到在哈希环上的位置， 然后沿着哈希环顺时针行走，第一台遇到的服务器就是该ip要定位到的服务器。
    * 如果一台机器不可用，则沿着哈希环顺时针行走略过该机器，仍然是第一台遇到的服务器就是该ip要定位的服务器。即：以这台不可用的机器为起点，沿着哈希环逆时针行走，直到遇到第一台机器作为终点。只有这两台机器之间的数据会受到影响，需要重新哈希定位。
    * 如果需要增加一台机器，只有新机器和逆时针走的第一台机器之间的数据会受到影响，需要重新哈希定位。